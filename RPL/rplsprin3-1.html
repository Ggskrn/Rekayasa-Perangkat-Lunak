<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Progress Project - PT Sinar Baja Bumi</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Montserrat:wght@300;400;500&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
      :root {
        --primary-color: #8B6B4A;
        --secondary-color: #6F4E37;
        --bg-color: #F5F3EE;
        --card-color: #FFFFFF;
        --text-color: #333333;
        --sidebar-color: #5D4037;
        --success-color: #4E8C48;
        --danger-color: #A44A3F;
        --warning-color: #D4A017;
        --gold-accent: #C9B38B;
        --dark-brown: #3E2723;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: 'Montserrat', sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        min-height: 100vh;
      }

      /* Login Page Styles */
      .login-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background-image: url('https://images.unsplash.com/photo-1600585154340-be6161a56a0c?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
        background-size: cover;
        background-position: center;
        background-blend-mode: overlay;
        background-color: rgba(62, 39, 35, 0.85);
      }

      .login-box {
        background-color: var(--card-color);
        padding: 40px;
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        width: 100%;
        max-width: 450px;
        text-align: center;
        animation: fadeInUp 0.5s ease;
      }

      @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .login-logo {
        font-family: 'Playfair Display', serif;
        font-size: 28px;
        color: var(--dark-brown);
        margin-bottom: 30px;
        letter-spacing: 1px;
      }

      .login-form .form-group {
        margin-bottom: 20px;
        text-align: left;
      }

      .login-form label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--dark-brown);
      }

      .login-form input {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 15px;
        font-family: 'Montserrat', sans-serif;
        transition: all 0.3s ease;
      }

      .login-form input:focus {
        outline: none;
        border-color: var(--gold-accent);
        box-shadow: 0 0 0 3px rgba(201, 179, 139, 0.2);
      }

      .login-btn {
        width: 100%;
        padding: 12px;
        background-color: var(--dark-brown);
        color: white;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 10px;
      }

      .login-btn:hover {
        background-color: var(--primary-color);
      }

      /* Elegant Loading Screen */
      .loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(62, 39, 35, 0.9);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.5s ease;
      }

      .loading-screen.active {
        opacity: 1;
        pointer-events: all;
      }

      .loader {
        width: 80px;
        height: 80px;
        border: 8px solid var(--gold-accent);
        border-bottom-color: transparent;
        border-radius: 50%;
        display: inline-block;
        box-sizing: border-box;
        animation: rotation 1s linear infinite;
        margin-bottom: 20px;
      }

      .loading-text {
        color: var(--gold-accent);
        font-family: 'Playfair Display', serif;
        font-size: 24px;
        letter-spacing: 2px;
        margin-top: 20px;
      }

      @keyframes rotation {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      /* Main App Layout */
      .app-container {
        display: none;
        min-height: 100vh;
        background-image: url('https://images.unsplash.com/photo-1600585154340-be6161a56a0c?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        background-blend-mode: overlay;
        background-color: rgba(245, 243, 238, 0.9);
      }

      .app-container.active {
        display: flex;
      }

      /* Sidebar */
      .sidebar {
        width: 280px;
        background-color: var(--sidebar-color);
        color: white;
        padding: 30px 20px;
        display: flex;
        flex-direction: column;
        transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        z-index: 1000;
        box-shadow: 5px 0 15px rgba(0, 0, 0, 0.1);
      }

      .sidebar.collapsed {
        transform: translateX(-280px);
      }

      .sidebar-logo {
        text-align: center;
        margin-bottom: 30px;
        color: var(--gold-accent);
        font-size: 28px;
        font-weight: bold;
        font-family: 'Playfair Display', serif;
        letter-spacing: 1px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--gold-accent);
      }

      .sidebar-menu {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .sidebar-menu button {
        background: none;
        border: none;
        color: white;
        text-align: left;
        padding: 12px 20px;
        cursor: pointer;
        transition: all 0.4s ease;
        border-radius: 5px;
        font-size: 16px;
        display: flex;
        align-items: center;
        gap: 12px;
        font-family: 'Montserrat', sans-serif;
        font-weight: 500;
      }

      .sidebar-menu button:hover {
        background-color: rgba(201, 179, 139, 0.2);
        transform: translateX(10px);
      }

      .sidebar-menu button i {
        width: 24px;
        text-align: center;
        font-size: 18px;
        color: var(--gold-accent);
      }

      /* Main Content */
      .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: auto;
        transition: margin-left 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        background-color: rgba(245, 243, 238, 0.85);
      }

      .sidebar:not(.collapsed) + .main-content {
        margin-left: 280px;
      }

      /* Page Header */
      .page-header {
        background-color: var(--dark-brown);
        color: white;
        padding: 20px 40px;
        font-size: 24px;
        font-weight: bold;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-family: 'Playfair Display', serif;
        letter-spacing: 1px;
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .user-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background-color: var(--gold-accent);
        color: var(--dark-brown);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 18px;
        font-family: 'Playfair Display', serif;
        transition: all 0.3s ease;
      }

      .user-avatar:hover {
        transform: scale(1.1);
      }

      .user-details {
        display: flex;
        flex-direction: column;
      }

      .user-name {
        font-size: 16px;
        font-weight: bold;
        font-family: 'Montserrat', sans-serif;
      }

      .user-role {
        font-size: 13px;
        opacity: 0.8;
        font-family: 'Montserrat', sans-serif;
      }

      /* View Content */
      .view-content {
        padding: 40px;
        flex: 1;
        animation: fadeIn 0.8s ease;
      }

      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }

      /* Search Bar */
      .search-bar {
        display: flex;
        margin-bottom: 30px;
        gap: 15px;
      }

      .search-bar input {
        flex: 1;
        padding: 12px 20px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 15px;
        font-family: 'Montserrat', sans-serif;
        transition: all 0.3s ease;
        background-color: rgba(255, 255, 255, 0.8);
      }

      .search-bar input:focus {
        outline: none;
        border-color: var(--gold-accent);
        box-shadow: 0 0 0 2px rgba(201, 179, 139, 0.3);
      }

      .search-bar button {
        padding: 12px 25px;
        background-color: var(--dark-brown);
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'Montserrat', sans-serif;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .search-bar button:hover {
        background-color: var(--primary-color);
        transform: translateY(-2px);
      }

      /* Project Styles */
      .project {
        background: var(--card-color);
        margin-top: 20px;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.4s ease;
        border-left: 4px solid var(--gold-accent);
      }

      .project:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
      }

      .project.ongoing {
        border-left-color: var(--warning-color);
      }

      .project.completed {
        border-left-color: var(--success-color);
      }

      .project-info {
        flex: 1;
      }

      .project-info h3 {
        color: var(--dark-brown);
        font-family: 'Playfair Display', serif;
        margin-bottom: 8px;
        font-size: 20px;
      }

      .project-info p {
        color: var(--text-color);
        margin-bottom: 8px;
        font-size: 14px;
      }

      .project-info .status {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
        margin-top: 5px;
      }

      .project-info .status.ongoing {
        background-color: rgba(212, 160, 23, 0.1);
        color: var(--warning-color);
      }

      .project-info .status.completed {
        background-color: rgba(78, 140, 72, 0.1);
        color: var(--success-color);
      }

      .project-progress {
        text-align: right;
        min-width: 120px;
      }

      .project-progress .percentage {
        font-size: 24px;
        font-weight: bold;
        font-family: 'Playfair Display', serif;
        color: var(--dark-brown);
      }

      .project-progress .progress-bar-container {
        height: 8px;
        background-color: #e0e0e0;
        border-radius: 4px;
        margin: 8px 0;
        overflow: hidden;
      }

      .project-progress .progress-bar {
        height: 100%;
        border-radius: 4px;
        background-color: var(--gold-accent);
        transition: width 0.6s ease;
      }

      .project-actions {
        display: flex;
        gap: 10px;
        margin-top: 10px;
        justify-content: flex-end;
      }

      /* Info Text */
      .info {
        font-size: 16px;
        line-height: 1.8;
        max-width: 800px;
        margin: 0 auto;
        text-align: center;
        padding: 30px;
        background: var(--card-color);
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        font-family: 'Montserrat', sans-serif;
      }

      /* View Toggle */
      .view {
        display: none;
        flex-direction: column;
        height: 100%;
        position: relative;
      }

      .view.active {
        display: flex;
      }

      /* Dashboard Cards */
      .dashboard-cards {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 25px;
        margin-top: 30px;
      }

      .dashboard-card {
        background: var(--card-color);
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        transition: all 0.4s ease;
        cursor: pointer;
        border-top: 4px solid var(--gold-accent);
        animation: cardEnter 0.6s ease;
      }

      .dashboard-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.12);
      }

      @keyframes cardEnter {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .dashboard-card h3 {
        color: var(--dark-brown);
        font-family: 'Playfair Display', serif;
        margin-bottom: 15px;
        font-size: 20px;
        letter-spacing: 0.5px;
      }

      .dashboard-card .value {
        font-size: 32px;
        font-weight: bold;
        margin-bottom: 15px;
        font-family: 'Playfair Display', serif;
        color: var(--primary-color);
      }

      .dashboard-card .progress-container {
        height: 10px;
        background-color: #e0e0e0;
        border-radius: 5px;
        margin-bottom: 15px;
        overflow: hidden;
      }

      .dashboard-card .progress-bar {
        height: 100%;
        border-radius: 5px;
        background-color: var(--gold-accent);
        transition: width 1s ease;
      }

      .dashboard-card .info-text {
        font-size: 13px;
        color: #666;
        font-family: 'Montserrat', sans-serif;
      }

      /* Button Styles */
      .btn {
        min-width: 120px;
        height: 45px;
        color: #fff;
        padding: 5px 15px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        position: relative;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        outline: none;
        border-radius: 5px;
        border: none;
        background: var(--dark-brown);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        font-family: 'Montserrat', sans-serif;
        overflow: hidden;
      }

      .btn::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(rgba(255,255,255,0.1), rgba(255,255,255,0));
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
      }

      .btn:hover::after {
        opacity: 1;
      }

      .btn:active {
        transform: translateY(1px);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .btn i {
        margin-right: 8px;
      }

      .btn-danger {
        background: var(--danger-color);
      }

      .btn-success {
        background: var(--success-color);
      }

      /* Form Styles */
      .form-container {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: var(--card-color);
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        z-index: 1001;
        display: none;
        width: 90%;
        max-width: 700px;
        max-height: 90vh;
        overflow-y: auto;
        animation: modalEnter 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        border-top: 5px solid var(--gold-accent);
      }

      @keyframes modalEnter {
        from { opacity: 0; transform: translate(-50%, -60%); }
        to { opacity: 1; transform: translate(-50%, -50%); }
      }

      .form-container.active {
        display: block;
      }

      .form-container h3 {
        color: var(--dark-brown);
        margin-bottom: 25px;
        font-size: 24px;
        font-family: 'Playfair Display', serif;
        letter-spacing: 0.5px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--dark-brown);
        font-family: 'Montserrat', sans-serif;
      }

      .form-container input,
      .form-container textarea,
      .form-container select {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 15px;
        font-family: 'Montserrat', sans-serif;
        transition: all 0.3s ease;
        background-color: rgba(255, 255, 255, 0.8);
      }

      .form-container input:focus,
      .form-container textarea:focus,
      .form-container select:focus {
        outline: none;
        border-color: var(--gold-accent);
        box-shadow: 0 0 0 3px rgba(201, 179, 139, 0.2);
      }

      .form-container textarea {
        min-height: 100px;
        resize: vertical;
      }

      .form-section {
        margin-top: 25px;
        padding-top: 20px;
        border-top: 1px solid #eee;
      }

      .form-section h4 {
        color: var(--dark-brown);
        margin-bottom: 15px;
        font-size: 18px;
        font-family: 'Playfair Display', serif;
      }

      .file-upload {
        position: relative;
        margin: 20px 0;
      }

      .file-upload input[type="file"] {
        display: none;
      }

      .file-upload label {
        display: inline-flex;
        align-items: center;
        padding: 10px 20px;
        background-color: var(--bg-color);
        border: 1px solid #ddd;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s ease;
        font-family: 'Montserrat', sans-serif;
      }

      .file-upload label:hover {
        background-color: #e8e5dd;
      }

      .file-upload label i {
        margin-right: 8px;
        color: var(--primary-color);
      }

      #file-chosen {
        margin-left: 10px;
        font-size: 14px;
        color: #666;
      }

      .upload-btn {
        background-color: var(--dark-brown);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 15px;
        margin-top: 10px;
        transition: all 0.3s ease;
        font-family: 'Montserrat', sans-serif;
      }

      .upload-btn:hover {
        background-color: var(--primary-color);
      }

      .save-btn {
        background-color: var(--success-color);
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 500;
        width: 100%;
        margin-top: 20px;
        transition: all 0.3s ease;
        font-family: 'Montserrat', sans-serif;
        letter-spacing: 0.5px;
      }

      .save-btn:hover {
        background-color: #3d6e38;
      }

      .delete-btn {
        background-color: var(--danger-color);
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s ease;
        font-family: 'Montserrat', sans-serif;
      }

      .delete-btn:hover {
        background-color: #8c3d35;
      }

      /* Overlay for form */
      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(62, 39, 35, 0.7);
        z-index: 1000;
        display: none;
        animation: fadeIn 0.3s ease;
      }

      .overlay.active {
        display: block;
      }

      /* Close button for form */
      .close-btn {
        position: absolute;
        top: 15px;
        right: 15px;
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #999;
        transition: all 0.3s ease;
      }

      .close-btn:hover {
        color: var(--danger-color);
        transform: rotate(90deg);
      }

      /* Chatbox */
      .chatbox-container {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 350px;
        z-index: 1000;
        transform: translateY(100%);
        opacity: 0;
        transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      }

      .chatbox-container.active {
        transform: translateY(0);
        opacity: 1;
      }

      .chatbox-header {
        background-color: var(--dark-brown);
        color: white;
        padding: 15px 20px;
        border-radius: 10px 10px 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        font-family: 'Montserrat', sans-serif;
      }

      .chatbox-header h3 {
        font-size: 16px;
        font-weight: 500;
      }

      .chatbox-header i {
        font-size: 18px;
        transition: transform 0.3s ease;
      }

      .chatbox-header.active i {
        transform: rotate(180deg);
      }

      .chatbox-body {
        background-color: var(--card-color);
        border-radius: 0 0 10px 10px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.5s ease;
      }

      .chatbox-body.active {
        max-height: 400px;
      }

      .chat-messages {
        padding: 15px;
        height: 300px;
        overflow-y: auto;
      }

      .message {
        margin-bottom: 15px;
        display: flex;
        flex-direction: column;
      }

      .message.admin {
        align-items: flex-end;
      }

      .message.client {
        align-items: flex-start;
      }

      .message-content {
        max-width: 80%;
        padding: 10px 15px;
        border-radius: 18px;
        font-size: 14px;
        line-height: 1.4;
      }

      .message.admin .message-content {
        background-color: var(--gold-accent);
        color: var(--dark-brown);
        border-bottom-right-radius: 5px;
      }

      .message.client .message-content {
        background-color: var(--dark-brown);
        color: white;
        border-bottom-left-radius: 5px;
      }

      .message-time {
        font-size: 11px;
        color: #999;
        margin-top: 5px;
      }

      .chat-input {
        display: flex;
        padding: 10px;
        border-top: 1px solid #eee;
      }

      .chat-input input {
        flex: 1;
        padding: 10px 15px;
        border: 1px solid #ddd;
        border-radius: 20px;
        outline: none;
        font-size: 14px;
        font-family: 'Montserrat', sans-serif;
      }

      .chat-input button {
        background-color: var(--dark-brown);
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        margin-left: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .chat-input button:hover {
        background-color: var(--primary-color);
      }

      /* Toggle Chat Button */
      .chat-toggle {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 60px;
        height: 60px;
        background-color: var(--dark-brown);
        color: white;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        z-index: 1001;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
      }

      .chat-toggle:hover {
        transform: scale(1.1);
        background-color: var(--primary-color);
      }

      .chat-toggle i {
        font-size: 24px;
      }

      /* Hamburger menu */
      .hamburger-menu {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1001;
        background: var(--dark-brown);
        border: none;
        border-radius: 5px;
        padding: 12px;
        cursor: pointer;
        display: none;
        transition: all 0.3s ease;
      }

      .hamburger-menu:hover {
        background-color: var(--primary-color);
      }

      .hamburger-menu span {
        display: block;
        width: 25px;
        height: 3px;
        background-color: white;
        margin: 5px 0;
        transition: 0.4s;
      }

      /* User Management Styles */
      .user-management {
        margin-top: 30px;
      }

      .user-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        background-color: var(--card-color);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        border-radius: 10px;
        overflow: hidden;
      }

      .user-table th, .user-table td {
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid #eee;
      }

      .user-table th {
        background-color: var(--dark-brown);
        color: white;
        font-family: 'Playfair Display', serif;
      }

      .user-table tr:hover {
        background-color: rgba(201, 179, 139, 0.1);
      }

      .user-table .role-badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
      }

      .user-table .role-admin {
        background-color: rgba(139, 107, 74, 0.1);
        color: var(--primary-color);
      }

      .user-table .role-engineer {
        background-color: rgba(78, 140, 72, 0.1);
        color: var(--success-color);
      }

      .user-table .role-client {
        background-color: rgba(164, 74, 63, 0.1);
        color: var(--danger-color);
      }

      /* Report Styles */
      .report-container {
        background-color: var(--card-color);
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        margin-top: 30px;
      }

      .report-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #eee;
      }

      .report-title {
        font-family: 'Playfair Display', serif;
        color: var(--dark-brown);
        font-size: 24px;
      }

      .download-btn {
        background-color: var(--dark-brown);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-family: 'Montserrat', sans-serif;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .download-btn:hover {
        background-color: var(--primary-color);
      }

      .report-table {
        width: 100%;
        border-collapse: collapse;
      }

      .report-table th, .report-table td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #eee;
      }

      .report-table th {
        background-color: var(--bg-color);
        font-family: 'Playfair Display', serif;
        color: var(--dark-brown);
      }

      .report-table tr:last-child td {
        border-bottom: none;
      }

      .report-table .file-link {
        color: var(--primary-color);
        text-decoration: none;
        transition: all 0.3s ease;
      }

      .report-table .file-link:hover {
        text-decoration: underline;
      }

      /* Responsive styles */
      @media (max-width: 768px) {
        .sidebar {
          position: fixed;
          left: -280px;
          top: 0;
          height: 100%;
        }

        .sidebar.open {
          left: 0;
        }

        .sidebar:not(.collapsed) + .main-content {
          margin-left: 0;
        }

        .hamburger-menu {
          display: block;
        }

        .dashboard-cards {
          grid-template-columns: 1fr;
        }

        .view-content {
          padding: 20px;
        }

        .page-header {
          padding: 15px 20px;
        }

        .search-bar {
          flex-direction: column;
        }

        .search-bar button {
          width: 100%;
        }

        .form-container {
          width: 95%;
          padding: 20px;
        }

        .chatbox-container {
          width: 90%;
          right: 5%;
        }

        .user-table, .report-table {
          display: block;
          overflow-x: auto;
        }
      }

      /* Background images for different views */
      .dashboard {
        background-image: url('https://images.unsplash.com/photo-1600585154340-be6161a56a0c?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
      }

      .progress {
        background-image: url('https://images.unsplash.com/photo-1507679799987-c73779587ccf?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
      }

      .about {
        background-image: url('https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
      }

      .logout {
        background-image: url('https://images.unsplash.com/photo-1497366754035-f200968a6e72?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
      }
    </style>
  </head>
  <body>
    <!-- Login Page -->
    <div class="login-container" id="loginPage">
      <div class="login-box">
        <div class="login-logo">PT Sinar Baja Bumi</div>
        <form class="login-form" onsubmit="handleLogin(event)">
          <div class="form-group">
            <label for="username">Username</label>
            <input type="text" id="username" placeholder="Masukkan username" required>
          </div>
          <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" placeholder="Masukkan password" required>
          </div>
          <button type="submit" class="login-btn">Masuk</button>
        </form>
      </div>
    </div>

    <!-- Main App (hidden until login) -->
    <div class="app-container" id="appContainer">
      <div class="loading-screen">
        <div class="loader"></div>
        <div class="loading-text">Memuat...</div>
      </div>

      <button class="hamburger-menu" onclick="toggleSidebar()">
        <span></span>
        <span></span>
        <span></span>
      </button>

      <div class="sidebar">
        <div class="sidebar-logo">PT Sinar Baja Bumi</div>
        <div class="sidebar-menu">
          <button onclick="switchView('dashboard')">
            <i class="fas fa-tachometer-alt"></i> Dashboard
          </button>
          <button onclick="switchView('progress')">
            <i class="fas fa-project-diagram"></i> Project
          </button>
          <button id="userManagementBtn" style="display: none;" onclick="switchView('users')">
            <i class="fas fa-users-cog"></i> Manajemen User
          </button>
          <button onclick="switchView('about')">
            <i class="fas fa-info-circle"></i> Tentang Kami
          </button>
          <button onclick="logout()">
            <i class="fas fa-sign-out-alt"></i> Logout
          </button>
        </div>
      </div>

      <div class="main-content">
        <div class="page-header">
          <div id="page-title">Dashboard</div>
          <div class="user-info">
            <div class="user-avatar" id="userAvatar">GC</div>
            <div class="user-details">
              <div class="user-name" id="userName">Gagas Cahya</div>
              <div class="user-role" id="userRole">Engineer</div>
            </div>
          </div>
        </div>

        <div class="view active" id="dashboard">
          <div class="view-content">
            <div class="dashboard-cards">
              <div class="dashboard-card">
                <h3>Total Projects</h3>
                <div class="value" id="totalProjects">0</div>
                <div class="info-text">All projects in the system</div>
              </div>
              <div class="dashboard-card">
                <h3>Ongoing Projects</h3>
                <div class="value" id="ongoingProjects">0</div>
                <div class="info-text">Projects currently in progress</div>
              </div>
              <div class="dashboard-card">
                <h3>Completed Projects</h3>
                <div class="value" id="completedProjects">0</div>
                <div class="info-text">Successfully finished projects</div>
              </div>
              <div class="dashboard-card">
                <h3>Project Progress</h3>
                <div class="value" id="avgProgress">0%</div>
                <div class="progress-container">
                  <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                </div>
                <div class="info-text">Average completion rate</div>
              </div>
            </div>
          </div>
        </div>

        <div class="view" id="progress">
          <div class="view-content">
            <div class="search-bar">
              <input type="text" id="searchInput" placeholder="Search projects..." />
              <button onclick="searchProjects()"><i class="fas fa-search"></i> Search</button>
              <button class="btn" id="addProjectBtn" onclick="showAddForm()"><i class="fas fa-plus"></i> Add Project</button>
            </div>

            <div id="projectList"></div>
          </div>
        </div>

        <div class="view" id="users" style="display: none;">
          <div class="view-content">
            <h2 style="margin-bottom: 20px;">Manajemen Pengguna</h2>
            <button class="btn" onclick="showAddUserForm()"><i class="fas fa-user-plus"></i> Tambah Pengguna</button>
            
            <div class="user-management">
              <table class="user-table">
                <thead>
                  <tr>
                    <th>Nama</th>
                    <th>Username</th>
                    <th>Role</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody id="userTableBody">
                  <!-- User data will be populated here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="view" id="about">
          <div class="view-content">
            <h2 style="text-align: center; margin-bottom: 20px">
              PT SINAR BAJA BUMI
            </h2>
            <p class="info">
              Perusahaan kami bergerak di bidang konstruksi baja dengan pengalaman lebih dari 20 tahun.
              Kami menyediakan solusi konstruksi baja berkualitas tinggi untuk berbagai proyek baik skala kecil maupun besar.
            </p>
            <div class="dashboard-cards">
              <div class="dashboard-card">
                <h3>Visi</h3>
                <p>Menjadi perusahaan konstruksi baja terdepan di Indonesia dengan kualitas dan inovasi terbaik.</p>
              </div>
              <div class="dashboard-card">
                <h3>Misi</h3>
                <p>Memberikan solusi konstruksi baja yang efisien, aman, dan berkualitas tinggi dengan layanan terpadu.</p>
              </div>
            </div>
          </div>
        </div>

        <div class="view" id="logout">
          <div class="view-content">
            <h2 style="text-align: center">Anda telah logout.</h2>
            <p class="info">
              Silakan tutup tab ini atau login kembali untuk melanjutkan.
            </p>
          </div>
        </div>
      </div>

      <!-- Project Form Overlay -->
      <div class="overlay" id="formOverlay"></div>

      <div class="form-container" id="projectForm">
        <button class="close-btn" onclick="hideForm()">&times;</button>
        <h3 id="formTitle">Tambah Detail Project</h3>
        <div class="form-group">
          <label for="projectTitle">Judul Project</label>
          <input type="text" id="projectTitle" placeholder="Judul Project" />
        </div>
        <div class="form-group">
          <label for="projectDetail">Detail Project</label>
          <textarea id="projectDetail" placeholder="Detail Project"></textarea>
        </div>
        <div class="form-group">
          <label for="statusInput">Status</label>
          <select id="statusInput" onchange="updateProgressFromStatus()">
            <option value="">-- Pilih Status --</option>
            <option value="Perencanaan">Perencanaan</option>
            <option value="Persiapan">Persiapan</option>
            <option value="Produksi">Produksi</option>
            <option value="Pengawasan">Pengawasan</option>
            <option value="Penyelesaian">Penyelesaian</option>
          </select>
        </div>

        <div class="form-section">
          <h4>Catatan & Lampiran</h4>
          <div class="form-group">
            <label for="attachmentText">Catatan</label>
            <textarea id="attachmentText" placeholder="Tambahkan catatan..."></textarea>
          </div>
          <div class="form-group">
            <label for="attachmentFile">Lampiran File</label>
            <div class="file-upload">
              <input type="file" id="attachmentFile" accept="image/*,.pdf,.doc,.docx,.txt" />
              <label for="attachmentFile">Pilih File</label>
              <span id="file-chosen">Tidak ada file dipilih</span>
            </div>
          </div>
          <button type="button" class="btn" onclick="addAttachment()">Unggah</button>
        </div>

        <div class="attachment-log" id="attachmentLog"></div>

        <button type="button" class="save-btn" onclick="saveProject()">
          Simpan Project
        </button>
      </div>

      <!-- User Form -->
      <div class="form-container" id="userForm">
        <button class="close-btn" onclick="hideUserForm()">&times;</button>
        <h3 id="userFormTitle">Tambah Pengguna</h3>
        <div class="form-group">
          <label for="fullName">Nama Lengkap</label>
          <input type="text" id="fullName" placeholder="Nama lengkap pengguna" required>
        </div>
        <div class="form-group">
          <label for="newUsername">Username</label>
          <input type="text" id="newUsername" placeholder="Username untuk login" required>
        </div>
        <div class="form-group">
          <label for="newPassword">Password</label>
          <input type="password" id="newPassword" placeholder="Password untuk login" required>
        </div>
        <div class="form-group">
          <label for="userRoleSelect">Role</label>
          <select id="userRoleSelect" required>
            <option value="">-- Pilih Role --</option>
            <option value="admin">Admin</option>
            <option value="engineer">Pegawai</option>
            <option value="client">Client</option>
          </select>
        </div>
        <div class="form-group" id="clientSelectContainer" style="display: none;">
          <label for="clientSelect">Client</label>
          <select id="clientSelect">
            <option value="">-- Pilih Client --</option>
          </select>
        </div>
        <button type="button" class="save-btn" onclick="saveUser()">
          Simpan Pengguna
        </button>
      </div>

      <!-- Report View -->
      <div class="form-container" id="reportView">
        <button class="close-btn" onclick="hideReportView()">&times;</button>
        <div class="report-container">
          <div class="report-header">
            <h3 class="report-title" id="reportProjectTitle">Laporan Proyek</h3>
            <button class="download-btn" onclick="generatePDF()">
              <i class="fas fa-download"></i> Unduh PDF
            </button>
          </div>
          <div id="reportContent">
            <!-- Report content will be generated here -->
          </div>
        </div>
      </div>
    </div>

    <script>
      // Database simulation (in a real app, this would be API calls to your backend)
      const db = {
        projects: [],
        users: [
          {
            id: 1,
            username: 'admin',
            password: 'admin123',
            role: 'admin',
            nama_lengkap: 'Devi Rahmawati'
          },
          {
            id: 2,
            username: 'engineer',
            password: 'engineer123',
            role: 'engineer',
            nama_lengkap: 'Gagas Cahya'
          },
          {
            id: 3,
            username: 'client1',
            password: 'client123',
            role: 'client',
            nama_lengkap: 'PT Bangun Jaya Abadi',
            client_id: 1
          },
          {
            id: 4,
            username: 'client2',
            password: 'client123',
            role: 'client',
            nama_lengkap: 'PT Konstruksi Maju Bersama',
            client_id: 2
          }
        ],
        clients: [
          {
            id: 1,
            nama: 'PT Bangun Jaya Abadi',
            alamat: 'Jl. Raya Bekasi No. 123',
            kontak: '08123456789',
            email: 'info@bangunjaya.com'
          },
          {
            id: 2,
            nama: 'PT Konstruksi Maju Bersama',
            alamat: 'Jl. Sudirman No. 456, Jakarta',
            kontak: '08234567890',
            email: 'kontak@kmb.co.id'
          }
        ],
        currentUser: null,
        editingUserId: null
      };

      // Initialize with some sample projects if empty
      if (db.projects.length === 0) {
        db.projects = [
          {
            id: 1,
            title: "Pembangunan Gudang Baja",
            detail: "Pembangunan gudang penyimpanan material baja untuk PT Bangun Jaya Abadi",
            status: "Produksi",
            progress: 60,
            log: "",
            createdBy: 1,
            clientId: 1,
            createdAt: new Date('2025-01-15'),
            attachments: [
              {
                id: 1,
                filename: "desain-gudang.pdf",
                note: "Desain awal gudang",
                date: "2025-01-20",
                uploadedBy: 1
              },
              {
                id: 2,
                filename: "progress-jan.jpg",
                note: "Progress pembangunan bulan Januari",
                date: "2025-01-30",
                uploadedBy: 2
              }
            ]
          },
          {
            id: 2,
            title: "Renovasi Kantor Pusat",
            detail: "Renovasi struktur kantor pusat PT Konstruksi Maju Bersama",
            status: "Pengawasan",
            progress: 75,
            log: "",
            createdBy: 1,
            clientId: 2,
            createdAt: new Date('2025-03-10'),
            attachments: [
              {
                id: 1,
                filename: "proposal-renovasi.pdf",
                note: "Proposal renovasi kantor",
                date: "2025-03-15",
                uploadedBy: 1
              }
            ]
          },
          {
            id: 3,
            title: "Proyek Jembatan Baja",
            detail: "Pembangunan jembatan baja di atas sungai untuk pemerintah daerah",
            status: "Penyelesaian",
            progress: 100,
            log: "",
            createdBy: 1,
            clientId: null,
            createdAt: new Date('2024-11-20'),
            attachments: []
          }
        ];
      }

      // DOM elements
      const loadingScreen = document.querySelector('.loading-screen');
      let editingIndex = null;
      let progress = 0;
      let lastStatusLevel = 0;

      // Initialize the app
      document.addEventListener('DOMContentLoaded', () => {
        // Set up file input display
        const fileInput = document.getElementById('attachmentFile');
        const fileChosen = document.getElementById('file-chosen');
        
        fileInput.addEventListener('change', function() {
          if (this.files.length > 0) {
            fileChosen.textContent = this.files[0].name;
          } else {
            fileChosen.textContent = 'Tidak ada file dipilih';
          }
        });

        // Hide main app until login
        document.getElementById('appContainer').style.display = 'none';
      });

      // Handle login form submission
      function handleLogin(event) {
        event.preventDefault();
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        
        if (login(username, password)) {
          // Show loading screen
          showLoading();
          
          // Hide login page and show app after a short delay
          setTimeout(() => {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('appContainer').style.display = 'flex';
            document.getElementById('appContainer').classList.add('active');
            
            // Initialize app based on user role
            initializeApp();
            
            hideLoading();
          }, 1000);
        } else {
          alert('Username atau password salah!');
        }
      }

      // Initialize app based on user role
      function initializeApp() {
        // Update user info in header
        document.getElementById('userName').textContent = db.currentUser.nama_lengkap;
        document.getElementById('userRole').textContent = db.currentUser.role === 'engineer' ? 'Pegawai' : 
                                                         db.currentUser.role === 'admin' ? 'Admin' : 'Client';
        document.getElementById('userAvatar').textContent = db.currentUser.nama_lengkap.split(' ').map(n => n[0]).join('').substring(0, 2);
        
        // Show/hide elements based on role
        if (db.currentUser.role === 'admin') {
          document.getElementById('userManagementBtn').style.display = 'block';
          document.getElementById('addProjectBtn').style.display = 'block';
        } else if (db.currentUser.role === 'engineer') {
          document.getElementById('userManagementBtn').style.display = 'none';
          document.getElementById('addProjectBtn').style.display = 'block';
        } else { // client
          document.getElementById('userManagementBtn').style.display = 'none';
          document.getElementById('addProjectBtn').style.display = 'none';
        }
        
        // Update dashboard stats
        updateDashboardStats();
        
        // Render projects
        renderProjects();
      }

      // Login function
      function login(username, password) {
        const user = db.users.find(u => u.username === username && u.password === password);
        if (user) {
          db.currentUser = user;
          return true;
        }
        return false;
      }

      // Logout function
      function logout() {
        db.currentUser = null;
        switchView('logout');
        
        // After 2 seconds, show login page again
        setTimeout(() => {
          document.getElementById('appContainer').style.display = 'none';
          document.getElementById('appContainer').classList.remove('active');
          document.getElementById('loginPage').style.display = 'flex';
          
          // Clear login form
          document.getElementById('username').value = '';
          document.getElementById('password').value = '';
        }, 2000);
      }

      // Toggle sidebar
      function toggleSidebar() {
        const sidebar = document.querySelector(".sidebar");
        if (window.innerWidth >= 769) {
          sidebar.classList.toggle("collapsed");
        } else {
          sidebar.classList.toggle("open");
        }
      }

      // Switch between views with loading screen
      function switchView(viewId) {
        showLoading();
        
        setTimeout(() => {
          document.querySelectorAll(".view").forEach((v) => v.classList.remove("active"));
          document.getElementById(viewId).classList.add("active");

          // Update header title
          const titleMap = {
            dashboard: "Dashboard",
            progress: "Project",
            users: "Manajemen User",
            about: "Tentang Kami",
            logout: "Logout"
          };
          document.getElementById("page-title").textContent = titleMap[viewId];

          // Update content based on view
          if (viewId === 'dashboard') {
            updateDashboardStats();
          } else if (viewId === 'progress') {
            renderProjects();
          } else if (viewId === 'users') {
            renderUserTable();
          }
          
          // Close sidebar on mobile
          if (window.innerWidth < 769) {
            document.querySelector(".sidebar").classList.remove("open");
          }
          
          hideLoading();
        }, 500);
      }

      // Show loading screen
      function showLoading() {
        loadingScreen.classList.add('active');
      }

      // Hide loading screen
      function hideLoading() {
        loadingScreen.classList.remove('active');
      }

      // Show add project form
      function showAddForm() {
        document.getElementById('formOverlay').classList.add('active');
        document.getElementById('projectForm').classList.add('active');
        document.getElementById('formTitle').textContent = 'Tambah Detail Project';
        clearForm();
      }

      // Show edit project form
      function showEditForm(index) {
        document.getElementById('formOverlay').classList.add('active');
        document.getElementById('projectForm').classList.add('active');
        document.getElementById('formTitle').textContent = 'Edit Detail Project';
        editProject(index);
      }

      // Hide form
      function hideForm() {
        document.getElementById('formOverlay').classList.remove('active');
        document.getElementById('projectForm').classList.remove('active');
      }

      // Clear form
      function clearForm() {
        document.getElementById("projectTitle").value = "";
        document.getElementById("projectDetail").value = "";
        document.getElementById("statusInput").value = "";
        document.getElementById("attachmentLog").innerHTML = "";
        document.getElementById("attachmentText").value = "";
        document.getElementById("attachmentFile").value = "";
        document.getElementById("file-chosen").textContent = "Tidak ada file dipilih";
        progress = 0;
        lastStatusLevel = 0;
        editingIndex = null;
      }

      // Add attachment
      function addAttachment() {
        const text = document.getElementById("attachmentText").value;
        const file = document.getElementById("attachmentFile").files[0];
        const log = document.getElementById("attachmentLog");
        const status = document.getElementById("statusInput").value;
        const now = new Date().toLocaleString();

        if (!text && !file) {
          alert("Tulis catatan atau pilih file terlebih dahulu.");
          return;
        }

        if (!status) {
          alert("Pilih status proyek terlebih dahulu.");
          return;
        }

        // Find or create section for this status
        let section = document.getElementById(`log-${status}`);
        if (!section) {
          section = document.createElement("div");
          section.id = `log-${status}`;
          section.innerHTML = `<hr><strong>${status}</strong><br>`;
          log.appendChild(section);
        }

        // Create note/attachment
        const entry = document.createElement("div");
        entry.innerHTML = `> <small>${text}</small><br/><small>${now}</small><br/>`;

        if (file) {
          const url = URL.createObjectURL(file);
          const link = document.createElement("a");
          link.href = url;
          link.download = file.name;
          link.textContent = `${file.name}`;
          link.style.display = "block";
          entry.appendChild(link);
        }

        section.appendChild(entry);

        // Reset input
        document.getElementById("attachmentText").value = "";
        document.getElementById("attachmentFile").value = "";
        document.getElementById("file-chosen").textContent = "Tidak ada file dipilih";
      }

      // Save project
      function saveProject() {
        const title = document.getElementById("projectTitle").value;
        const detail = document.getElementById("projectDetail").value;
        const status = document.getElementById("statusInput").value;
        const logHTML = document.getElementById("attachmentLog").innerHTML;

        // Enhanced validation
        if (!title) {
          alert("Mohon isi judul project.");
          return;
        }
        
        if (!detail) {
          alert("Mohon isi detail project.");
          return;
        }
        
        if (!status) {
          alert("Mohon pilih status project.");
          return;
        }

        try {
          // Create project data object
          const projectData = {
            id: editingIndex !== null ? db.projects[editingIndex].id : db.projects.length + 1,
            title,
            detail,
            status,
            progress, // This is set by updateProgressFromStatus function
            log: logHTML,
            createdBy: db.currentUser ? db.currentUser.id : 1, // Add fallback if user not logged in
            createdAt: editingIndex !== null ? db.projects[editingIndex].createdAt : new Date(),
            clientId: editingIndex !== null ? db.projects[editingIndex].clientId : null,
            attachments: editingIndex !== null ? db.projects[editingIndex].attachments || [] : []
          };

          // Save the project
          if (editingIndex !== null) {
            db.projects[editingIndex] = projectData;
            editingIndex = null;
          } else {
            db.projects.push(projectData);
          }

          // Update UI
          hideForm();
          renderProjects();
          updateDashboardStats();
          
          // Show success message
          alert("Project berhasil disimpan!");
        } catch (error) {
          // Show error if something goes wrong
          console.error("Error saving project:", error);
          alert("Terjadi kesalahan saat menyimpan project. Silakan coba lagi.");
        }
      }

      // Edit project
      function editProject(index) {
        const project = db.projects[index];
        document.getElementById("projectTitle").value = project.title;
        document.getElementById("projectDetail").value = project.detail;
        document.getElementById("statusInput").value = project.status;
        document.getElementById("attachmentLog").innerHTML = project.log || "";
        editingIndex = index;
        updateProgressFromStatus();
      }

      // Delete project
      function deleteProject(index) {
        if (confirm("Apakah Anda yakin ingin menghapus project ini?")) {
          db.projects.splice(index, 1);
          renderProjects();
          updateDashboardStats();
        }
      }

      // Get status level
      function getStatusLevel(status) {
        switch (status) {
          case "Perencanaan":
            return 1;
          case "Persiapan":
            return 2;
          case "Produksi":
            return 3;
          case "Pengawasan":
            return 4;
          case "Penyelesaian":
            return 5;
          default:
            return 0;
        }
      }

      // Update progress based on status
      function updateProgressFromStatus() {
        const select = document.getElementById("statusInput");
        const selectedStatus = select.value;
        const selectedLevel = getStatusLevel(selectedStatus);

        if (selectedLevel < lastStatusLevel) {
          alert("Status tidak bisa kembali ke tahap sebelumnya.");
          select.value = ""; // Reset selection
          return;
        }

        lastStatusLevel = selectedLevel;

        switch (selectedStatus) {
          case "Perencanaan":
            progress = 10;
            break;
          case "Persiapan":
            progress = 30;
            break;
          case "Produksi":
            progress = 60;
            break;
          case "Pengawasan":
            progress = 75;
            break;
          case "Penyelesaian":
            progress = 100;
            break;
          default:
            progress = 0;
        }

        // Disable attachment if status is Penyelesaian
        const isFinal = selectedStatus === "Penyelesaian";
        document.getElementById("attachmentText").disabled = isFinal;
        document.getElementById("attachmentFile").disabled = isFinal;
      }

      // Render projects
      function renderProjects(searchTerm = '', filter = 'all') {
        const container = document.getElementById("projectList");
        container.innerHTML = "";

        // Filter projects based on search term and filter
        let filteredProjects = db.projects;
        
        // Apply client filter if current user is a client
        if (db.currentUser && db.currentUser.role === 'client') {
          filteredProjects = filteredProjects.filter(project => 
            project.clientId === db.currentUser.client_id
          );
        }
        
        // Apply search filter
        if (searchTerm) {
          filteredProjects = filteredProjects.filter(project => {
            return project.title.toLowerCase().includes(searchTerm.toLowerCase()) || 
                   project.detail.toLowerCase().includes(searchTerm.toLowerCase()) ||
                   project.status.toLowerCase().includes(searchTerm.toLowerCase());
          });
        }
        
        // Apply status filter
        if (filter === 'ongoing') {
          filteredProjects = filteredProjects.filter(project => project.progress < 100);
        } else if (filter === 'completed') {
          filteredProjects = filteredProjects.filter(project => project.progress === 100);
        }

        if (filteredProjects.length === 0) {
          container.innerHTML = '<div class="info">Tidak ada project ditemukan</div>';
          return;
        }

        filteredProjects.forEach((project, index) => {
          // Find the original index in the full projects array
          const originalIndex = db.projects.findIndex(p => p.id === project.id);
          
          // Determine project class based on progress
          const projectClass = project.progress === 100 ? "project completed" : "project ongoing";
          
          // Find client name if project has clientId
          let clientInfo = '';
          if (project.clientId) {
            const client = db.clients.find(c => c.id === project.clientId);
            if (client) {
              clientInfo = `<p>Client: ${client.nama}</p>`;
            }
          }
          
          const div = document.createElement("div");
          div.className = projectClass;
          
          // Basic project info
          let projectHTML = `
            <div class="project-info">
              <h3>${project.title}</h3>
              ${clientInfo}
              <p>${project.detail}</p>
              <p>Status: ${project.status}</p>
              <span class="status ${project.progress === 100 ? 'completed' : 'ongoing'}">${project.progress === 100 ? 'Selesai' : 'Sedang Berjalan'}</span>
            </div>
            <div class="project-progress">
              <div class="percentage">${project.progress}%</div>
              <div class="progress-bar-container">
                <div class="progress-bar" style="width: ${project.progress}%"></div>
              </div>`;
          
          // Add action buttons based on user role
          if (db.currentUser && (db.currentUser.role === 'admin' || db.currentUser.role === 'engineer')) {
            projectHTML += `
              <div class="project-actions">
                <button class="btn" onclick="showEditForm(${originalIndex})"><i class="fas fa-edit"></i> Edit</button>
                ${db.currentUser.role === 'admin' ? `<button class="btn btn-danger" onclick="deleteProject(${originalIndex})"><i class="fas fa-trash"></i> Hapus</button>` : ''}
                <button class="btn btn-success" onclick="showReport(${originalIndex})"><i class="fas fa-file-alt"></i> Laporan</button>
              </div>`;
          } else if (db.currentUser && db.currentUser.role === 'client') {
            projectHTML += `
              <div class="project-actions">
                <button class="btn btn-success" onclick="showReport(${originalIndex})"><i class="fas fa-file-alt"></i> Lihat Laporan</button>
              </div>`;
          }
          
          projectHTML += `</div>`;
          div.innerHTML = projectHTML;
          container.appendChild(div);
        });
      }

      // Show project report
      function showReport(projectIndex) {
        const project = db.projects[projectIndex];
        
        // Set report title
        document.getElementById('reportProjectTitle').textContent = `Laporan: ${project.title}`;
        
        // Generate report content
        const reportContent = document.getElementById('reportContent');
        reportContent.innerHTML = '';
        
        // Create report header
        const header = document.createElement('div');
        header.innerHTML = `
          <h4>Detail Proyek</h4>
          <p><strong>Judul:</strong> ${project.title}</p>
          <p><strong>Status:</strong> ${project.status}</p>
          <p><strong>Progress:</strong> ${project.progress}%</p>
          <p><strong>Deskripsi:</strong> ${project.detail}</p>
          <hr>
        `;
        reportContent.appendChild(header);
        
        // Add client info if available
        if (project.clientId) {
          const client = db.clients.find(c => c.id === project.clientId);
          if (client) {
            const clientInfo = document.createElement('div');
            clientInfo.innerHTML = `
              <h4>Informasi Client</h4>
              <p><strong>Nama:</strong> ${client.nama}</p>
              <p><strong>Alamat:</strong> ${client.alamat}</p>
              <p><strong>Kontak:</strong> ${client.kontak}</p>
              <p><strong>Email:</strong> ${client.email}</p>
              <hr>
            `;
            reportContent.appendChild(clientInfo);
          }
        }
        
        // Add attachments if available
        if (project.attachments && project.attachments.length > 0) {
          const attachmentsSection = document.createElement('div');
          attachmentsSection.innerHTML = '<h4>Lampiran</h4>';
          
          const table = document.createElement('table');
          table.className = 'report-table';
          table.innerHTML = `
            <thead>
              <tr>
                <th>Nama File</th>
                <th>Catatan</th>
                <th>Tanggal</th>
              </tr>
            </thead>
            <tbody>
              ${project.attachments.map(attachment => `
                <tr>
                  <td><a href="#" class="file-link" onclick="downloadAttachment('${attachment.filename}')">${attachment.filename}</a></td>
                  <td>${attachment.note}</td>
                  <td>${attachment.date}</td>
                </tr>
              `).join('')}
            </tbody>
          `;
          attachmentsSection.appendChild(table);
          reportContent.appendChild(attachmentsSection);
        } else {
          const noAttachments = document.createElement('p');
          noAttachments.textContent = 'Tidak ada lampiran untuk proyek ini.';
          reportContent.appendChild(noAttachments);
        }
        
        // Show the report view
        document.getElementById('formOverlay').classList.add('active');
        document.getElementById('reportView').classList.add('active');
      }

      // Generate PDF report
      function generatePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // Get project title
        const title = document.getElementById('reportProjectTitle').textContent;
        
        // Add title to PDF
        doc.setFontSize(18);
        doc.text(title, 105, 20, { align: 'center' });
        
        // Add current date
        doc.setFontSize(10);
        doc.text(`Dibuat pada: ${new Date().toLocaleDateString()}`, 105, 30, { align: 'center' });
        
        // Add line separator
        doc.setDrawColor(139, 107, 74);
        doc.setLineWidth(0.5);
        doc.line(20, 35, 190, 35);
        
        // Get all text content from report
        const contentElements = document.getElementById('reportContent').children;
        let yPosition = 45;
        
        doc.setFontSize(12);
        doc.setTextColor(0, 0, 0);
        
        for (let i = 0; i < contentElements.length; i++) {
          const element = contentElements[i];
          
          if (element.tagName === 'HR') {
            // Add line break
            yPosition += 10;
            doc.setDrawColor(200);
            doc.line(20, yPosition, 190, yPosition);
            yPosition += 10;
          } else if (element.tagName === 'H4') {
            // Add section header
            doc.setFontSize(14);
            doc.setTextColor(62, 39, 35);
            doc.text(element.textContent, 20, yPosition);
            yPosition += 10;
          } else if (element.tagName === 'P') {
            // Add paragraph
            const lines = doc.splitTextToSize(element.textContent, 170);
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            doc.text(lines, 20, yPosition);
            yPosition += lines.length * 7;
          } else if (element.tagName === 'TABLE') {
            // Add table
            const rows = [];
            const headers = [];
            
            // Get headers
            const headerCells = element.querySelectorAll('thead th');
            headerCells.forEach(cell => {
              headers.push(cell.textContent);
            });
            
            // Get rows data
            const dataRows = element.querySelectorAll('tbody tr');
            dataRows.forEach(row => {
              const rowData = [];
              const cells = row.querySelectorAll('td');
              cells.forEach(cell => {
                rowData.push(cell.textContent);
              });
              rows.push(rowData);
            });
            
            // Add table to PDF
            doc.autoTable({
              head: [headers],
              body: rows,
              startY: yPosition,
              theme: 'grid',
              headStyles: {
                fillColor: [62, 39, 35],
                textColor: 255
              },
              alternateRowStyles: {
                fillColor: [245, 243, 238]
              },
              margin: { top: 10 }
            });
            
            yPosition = doc.lastAutoTable.finalY + 10;
          }
          
          // Add new page if needed
          if (yPosition > 260) {
            doc.addPage();
            yPosition = 20;
          }
        }
        
        // Save the PDF
        doc.save(`Laporan_${title.replace(/ /g, '_')}.pdf`);
      }

      // Simulate file download
      function downloadAttachment(filename) {
        alert(`Fitur download lampiran: ${filename}\n\nDalam implementasi nyata, ini akan mengunduh file dari server.`);
      }

      // Hide report view
      function hideReportView() {
        document.getElementById('formOverlay').classList.remove('active');
        document.getElementById('reportView').classList.remove('active');
      }

      // Search projects
      function searchProjects() {
        const searchTerm = document.getElementById('searchInput').value;
        renderProjects(searchTerm);
      }

      // Update dashboard statistics
      function updateDashboardStats() {
        let totalProjects = db.projects.length;
        let ongoingProjects = db.projects.filter(p => p.progress < 100).length;
        let completedProjects = db.projects.filter(p => p.progress === 100).length;
        
        // If current user is client, filter their projects only
        if (db.currentUser && db.currentUser.role === 'client') {
          const clientProjects = db.projects.filter(p => p.clientId === db.currentUser.client_id);
          totalProjects = clientProjects.length;
          ongoingProjects = clientProjects.filter(p => p.progress < 100).length;
          completedProjects = clientProjects.filter(p => p.progress === 100).length;
        }
        
        const avgProgress = db.projects.reduce((sum, p) => sum + p.progress, 0) / Math.max(1, db.projects.length);

        document.getElementById('totalProjects').textContent = totalProjects;
        document.getElementById('ongoingProjects').textContent = ongoingProjects;
        document.getElementById('completedProjects').textContent = completedProjects;
        document.getElementById('avgProgress').textContent = `${Math.round(avgProgress)}%`;
        document.getElementById('progressBar').style.width = `${avgProgress}%`;
      }

      // User Management Functions
      function showAddUserForm() {
        document.getElementById('formOverlay').classList.add('active');
        document.getElementById('userForm').classList.add('active');
        document.getElementById('userFormTitle').textContent = 'Tambah Pengguna';
        document.getElementById('clientSelectContainer').style.display = 'none';
        clearUserForm();
      }

      function showEditUserForm(userId) {
        const user = db.users.find(u => u.id === userId);
        if (!user) return;
        
        document.getElementById('formOverlay').classList.add('active');
        document.getElementById('userForm').classList.add('active');
        document.getElementById('userFormTitle').textContent = 'Edit Pengguna';
        
        document.getElementById('fullName').value = user.nama_lengkap;
        document.getElementById('newUsername').value = user.username;
        document.getElementById('userRoleSelect').value = user.role;
        
        // Show client select if role is client
        if (user.role === 'client') {
          document.getElementById('clientSelectContainer').style.display = 'block';
          document.getElementById('clientSelect').value = user.client_id || '';
        } else {
          document.getElementById('clientSelectContainer').style.display = 'none';
        }
        
        db.editingUserId = userId;
      }

      function hideUserForm() {
        document.getElementById('formOverlay').classList.remove('active');
        document.getElementById('userForm').classList.remove('active');
        db.editingUserId = null;
      }

      function clearUserForm() {
        document.getElementById('fullName').value = '';
        document.getElementById('newUsername').value = '';
        document.getElementById('newPassword').value = '';
        document.getElementById('userRoleSelect').value = '';
        document.getElementById('clientSelect').value = '';
        db.editingUserId = null;
      }

      function saveUser() {
        const fullName = document.getElementById('fullName').value;
        const username = document.getElementById('newUsername').value;
        const password = document.getElementById('newPassword').value;
        const role = document.getElementById('userRoleSelect').value;
        const clientId = role === 'client' ? parseInt(document.getElementById('clientSelect').value) : null;
        
        // Validate inputs
        if (!fullName || !username || !role) {
          alert('Mohon isi semua field yang wajib!');
          return;
        }
        
        // For new user or password change, require password
        if ((!db.editingUserId || password) && !password) {
          alert('Mohon isi password!');
          return;
        }
        
        // For client role, require client selection
        if (role === 'client' && !clientId) {
          alert('Mohon pilih client untuk user ini!');
          return;
        }
        
        // Check if username already exists (for new user)
        if (!db.editingUserId && db.users.some(u => u.username === username)) {
          alert('Username sudah digunakan!');
          return;
        }
        
        try {
          if (db.editingUserId) {
            // Update existing user
            const userIndex = db.users.findIndex(u => u.id === db.editingUserId);
            if (userIndex !== -1) {
              db.users[userIndex].nama_lengkap = fullName;
              db.users[userIndex].username = username;
              if (password) {
                db.users[userIndex].password = password;
              }
              db.users[userIndex].role = role;
              if (role === 'client') {
                db.users[userIndex].client_id = clientId;
              } else {
                delete db.users[userIndex].client_id;
              }
            }
          } else {
            // Add new user
            const newUser = {
              id: db.users.length > 0 ? Math.max(...db.users.map(u => u.id)) + 1 : 1,
              nama_lengkap: fullName,
              username,
              password,
              role
            };
            
            if (role === 'client') {
              newUser.client_id = clientId;
            }
            
            db.users.push(newUser);
          }
          
          // Update UI
          hideUserForm();
          renderUserTable();
          
          // Show success message
          alert('Data pengguna berhasil disimpan!');
        } catch (error) {
          console.error('Error saving user:', error);
          alert('Terjadi kesalahan saat menyimpan data pengguna.');
        }
      }

      function deleteUser(userId) {
        if (confirm('Apakah Anda yakin ingin menghapus pengguna ini?')) {
          const userIndex = db.users.findIndex(u => u.id === userId);
          if (userIndex !== -1) {
            db.users.splice(userIndex, 1);
            renderUserTable();
          }
        }
      }

      function renderUserTable() {
        const tbody = document.getElementById('userTableBody');
        tbody.innerHTML = '';
        
        db.users.forEach(user => {
          if (user.role === 'client' && !user.client_id) return; // Skip invalid client users
          
          const tr = document.createElement('tr');
          
          // Role badge
          let roleBadge = '';
          if (user.role === 'admin') {
            roleBadge = '<span class="role-badge role-admin">Admin</span>';
          } else if (user.role === 'engineer') {
            roleBadge = '<span class="role-badge role-engineer">Pegawai</span>';
          } else if (user.role === 'client') {
            roleBadge = '<span class="role-badge role-client">Client</span>';
          }
          
          // Client info for client users
          let clientInfo = '';
          if (user.role === 'client' && user.client_id) {
            const client = db.clients.find(c => c.id === user.client_id);
            if (client) {
              clientInfo = `<small>${client.nama}</small>`;
            }
          }
          
          tr.innerHTML = `
            <td>${user.nama_lengkap}</td>
            <td>${user.username}</td>
            <td>${roleBadge} ${clientInfo}</td>
            <td>
              <button class="btn" onclick="showEditUserForm(${user.id})"><i class="fas fa-edit"></i></button>
              <button class="btn btn-danger" onclick="deleteUser(${user.id})"><i class="fas fa-trash"></i></button>
            </td>
          `;
          
          tbody.appendChild(tr);
        });
      }

      // Initialize client select dropdown
      function initClientSelect() {
        const select = document.getElementById('clientSelect');
        select.innerHTML = '<option value="">-- Pilih Client --</option>';
        
        db.clients.forEach(client => {
          const option = document.createElement('option');
          option.value = client.id;
          option.textContent = client.nama;
          select.appendChild(option);
        });
      }

      // Show/hide client select based on role selection
      document.getElementById('userRoleSelect').addEventListener('change', function() {
        const clientSelectContainer = document.getElementById('clientSelectContainer');
        if (this.value === 'client') {
          clientSelectContainer.style.display = 'block';
          initClientSelect();
        } else {
          clientSelectContainer.style.display = 'none';
        }
      });

      // Add click handlers to dashboard cards to filter projects accordingly
      document.addEventListener('DOMContentLoaded', () => {
        // Total projects card - show all projects
        document.querySelector('.dashboard-card:nth-child(1)').addEventListener('click', () => {
          switchView('progress');
          renderProjects('', 'all');
        });
        
        // Ongoing projects card - filter ongoing projects
        document.querySelector('.dashboard-card:nth-child(2)').addEventListener('click', () => {
          switchView('progress');
          renderProjects('', 'ongoing');
        });
        
        // Completed projects card - filter completed projects
        document.querySelector('.dashboard-card:nth-child(3)').addEventListener('click', () => {
          switchView('progress');
          renderProjects('', 'completed');
        });
      });
    </script>

    <style>
    .main-content {
    width: 100%;
    flex: 1;
    margin-left: 0 !important;
    flex: 1;
    width: 100%;
  }
  .view-content {
    width: 100%;
  }
    </style>
  </body>
</html>